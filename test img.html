<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Achievements</title>
  <style>
    .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px,1fr)); gap: 20px; }
    .card { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
    .card img { width: 100%; height: 150px; object-fit: cover; }
    .card h3 { margin: 10px; font-size: 18px; }
    .card p { margin: 10px; font-size: 14px; color: #444; }
    .date-tag { position: absolute; background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; border-radius: 5px; top: 10px; left: 10px; font-size:12px; }
    .card-header { position: relative; }
  </style>
</head>
<body>
  <h1>Student Achievements</h1>
  <div id="achievements-container" class="grid-container"></div>

<script>
async function fetchAndRenderAchievements() {
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JGoZwa0frysUABX2TvHqNcJfaWllRHo3Ppphf9diFiNB6j15qvi-AdJ3HxtdHzw2bN4TeoTvMQYg/pub?output=csv";
    const container = document.getElementById("achievements-container");

    container.innerHTML = `<p>Loading achievements...</p>`;

    try {
        const response = await fetch(csvUrl);
        const csvText = await response.text();

        const rows = csvText.trim().split("\n").map(r => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
        if (rows.length < 2) {
            container.innerHTML = `<p>⚠️ No achievements found yet.</p>`;
            return;
        }

        const headers = rows[0].map(h => h.trim());
        const dataRows = rows.slice(1);

        const colIndex = {
            title: headers.indexOf("The title"),
            desc: headers.indexOf("Description"),
            image: headers.indexOf("upload image (16:9)"),
            year: headers.indexOf("Year"),
        };

        container.innerHTML = "";
        let validCount = 0;

        for (const row of dataRows) {
            if (!row.join("").trim()) continue;

            const title = (row[colIndex.title] || "").trim();
            const desc = (row[colIndex.desc] || "").trim();
            const year = (row[colIndex.year] || "").trim();
            const imageUrl = (row[colIndex.image] || "").trim();

            if (!title && !desc) continue;

            validCount++;

            const wrapper = document.createElement("div");
            wrapper.className = "card-wrapper";

            const card = document.createElement("div");
            card.className = "card";

            const cardHeader = document.createElement("div");
            cardHeader.className = "card-header";

            const imageHeader = document.createElement("div");
            imageHeader.className = "image-header";

            const imgEl = document.createElement("img");
            imgEl.src = imageUrl || "https://placehold.co/600x400?text=No+Image";
            imgEl.alt = "Achievement";
            imgEl.onerror = function () {
                this.src = "https://placehold.co/600x400?text=No+Image";
            };  

            const dateTag = document.createElement("div");
            dateTag.className = "date-tag";
            dateTag.textContent = year || "N/A";

            imageHeader.appendChild(imgEl);
            imageHeader.appendChild(dateTag);

            const h3 = document.createElement("h3");
            h3.textContent = title || "Untitled";

            const p = document.createElement("p");
            p.textContent = desc;

            cardHeader.appendChild(imageHeader);
            cardHeader.appendChild(h3);
            card.appendChild(cardHeader);
            card.appendChild(p);

            wrapper.appendChild(card);
            container.appendChild(wrapper);
        }

        if (validCount === 0) {
            container.innerHTML = `<p>⚠️ No valid achievements found.</p>`;
        }

    } catch (err) {
        console.error("Error fetching sheet CSV:", err);
        container.innerHTML = `<p>⚠️ Unable to load achievements. Please try again later.</p>`;
    }
}

window.onload = fetchAndRenderAchievements;
</script>

</body>
</html>
